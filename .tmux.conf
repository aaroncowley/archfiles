##### Core #####
set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-256color:RGB"
set -as terminal-features ",tmux-256color:RGB"
set -g focus-events on
set -g history-limit 200000

# Faster and less "laggy" Esc in (n)vim
set -sg escape-time 0

# Improve responsiveness
set -g repeat-time 300
set -g status-interval 2

##### Prefix / ergonomics #####
# Use C-a as prefix (common + comfy). Unbind default C-b.
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Easy reload
bind r source-file ~/.tmux.conf \; display-message "Reloaded ~/.tmux.conf"

# Keep your current path when splitting
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Better pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick pane layouts
bind Space next-layout

##### Mouse + scrolling #####
set -g mouse on

# Scroll with mouse wheel enters copy-mode automatically
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "copy-mode -e"
bind -n WheelDownPane select-pane -t= \; send-keys -M

##### Copy-mode that feels good with Neovim #####
# Use vi keys in copy-mode
setw -g mode-keys vi

# Start selection with v, copy with y (vi-like)
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# System clipboard integration (Linux/macOS/WSL fallbacks)
# Requires ONE of: wl-copy (Wayland), xclip/xsel (X11), pbcopy (macOS), clip.exe (WSL)
set -g set-clipboard on
if-shell 'command -v wl-copy >/dev/null 2>&1' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "wl-copy"' \
  ''
if-shell 'command -v xclip >/dev/null 2>&1' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -in -selection clipboard"' \
  ''
if-shell 'command -v xsel >/dev/null 2>&1' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xsel --clipboard --input"' \
  ''
if-shell 'command -v pbcopy >/dev/null 2>&1' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"' \
  ''
if-shell 'command -v clip.exe >/dev/null 2>&1' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "clip.exe"' \
  ''

##### Neovim-friendly key behavior #####
# Make tmux pass through xterm keys properly (helps with some terminal/Nvim combos)
setw -g xterm-keys on

# Truecolor + undercurl support (most modern terminals)
set -ga terminal-overrides ',*:Tc'
set -ga terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -ga terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%m'

# Donâ€™t rename tabs automatically (lets you name sessions/windows cleanly)
set -g allow-rename off
setw -g automatic-rename off

##### Vim-aware pane navigation (THE important part) #####
# If the active pane is running (n)vim, send C-h/j/k/l to vim.
# Otherwise, switch tmux panes.
# This plays nicely with Neovim keymaps that use <C-h/j/k/l> for window nav.
is_vim='#{m:#{pane_current_command},(^|/)n?vim(diff)?$}'

bind -n C-h if-shell -F "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell -F "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell -F "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell -F "$is_vim" "send-keys C-l" "select-pane -R"

# Same behavior inside copy-mode
bind -T copy-mode-vi C-h select-pane -L
bind -T copy-mode-vi C-j select-pane -D
bind -T copy-mode-vi C-k select-pane -U
bind -T copy-mode-vi C-l select-pane -R

##### QoL window/session management #####
# More intuitive window switching
bind -n M-Left  previous-window
bind -n M-Right next-window

# Create windows in current directory
bind c new-window -c "#{pane_current_path}"

##### Status bar (clean, useful, minimal) #####
set -g status on
set -g status-justify left
set -g status-left-length 80
set -g status-right-length 120

# Left: session + window list
set -g status-left "#[bold]#S #[default]"
setw -g window-status-format " #I:#W "
setw -g window-status-current-format "#[reverse] #I:#W #[default]"

# Right: path + time
set -g status-right " #[dim]#{pane_current_path}#[default]  %Y-%m-%d %H:%M "

##### Misc sane defaults #####
# Start window/pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Keep window numbering compact
set -g renumber-windows on
